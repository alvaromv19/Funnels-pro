<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVO LAUNCH | AI Ad Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .neon-text { text-shadow: 0 0 10px rgba(56, 189, 248, 0.5); }
        .template-card.selected { border-color: #38bdf8; background-color: rgba(56, 189, 248, 0.1); }
    </style>
</head>
<body class="flex h-screen overflow-hidden selection:bg-sky-500 selection:text-white">

    <aside class="w-64 bg-slate-900 border-r border-slate-800 flex flex-col justify-between">
        <div>
            <div class="p-6 border-b border-slate-800">
                <h1 class="text-2xl font-bold text-sky-400 tracking-wider neon-text">EVO LAUNCH</h1>
                <p class="text-xs text-slate-400 mt-1 uppercase tracking-widest">By Alvaro MV</p>
            </div>
            
            <nav class="p-4 space-y-2">
                <button onclick="switchTab('ingesta')" id="btn-ingesta" class="nav-btn w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white transition-all">
                    <i class="fa-solid fa-brain w-5"></i><span class="font-semibold">1. Estrategia IA</span>
                </button>
                <button onclick="switchTab('laboratorio')" id="btn-laboratorio" class="nav-btn w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white transition-all">
                    <i class="fa-solid fa-flask w-5"></i><span class="font-semibold">2. Lab Creativo</span>
                </button>
                <button onclick="switchTab('setup')" id="btn-setup" class="nav-btn w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white transition-all">
                    <i class="fa-solid fa-sliders w-5"></i><span class="font-semibold">3. Setup Trafficker</span>
                </button>
                <button onclick="switchTab('lanzamiento')" id="btn-lanzamiento" class="nav-btn w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white transition-all">
                    <i class="fa-solid fa-rocket w-5"></i><span class="font-semibold">4. Lanzamiento</span>
                </button>
                <button onclick="switchTab('analitica')" id="btn-analitica" class="nav-btn w-full flex items-center space-x-3 px-4 py-3 rounded-lg bg-sky-600 text-white transition-all mt-4 border-t border-slate-700/50 pt-4">
                    <i class="fa-solid fa-chart-line w-5"></i><span class="font-semibold">5. Anal√≠tica & Reglas</span>
                </button>
            </nav>
        </div>
        <div class="p-4 border-t border-slate-800 flex items-center space-x-3">
            <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-sky-500 to-indigo-500 flex items-center justify-center font-bold shadow-lg shadow-sky-500/20">AM</div>
            <div>
                <p class="text-sm font-semibold text-white">Alvaro Maza</p>
                <p class="text-xs text-emerald-400"><i class="fa-solid fa-circle text-[8px] mr-1 blink"></i>API Conectada</p>
            </div>
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto bg-slate-950 p-8">
        
        <section id="ingesta" class="tab-content">
            <h2 class="text-3xl font-bold mb-2 text-white">1. Ingesta y Estrategia</h2>
            <p class="text-slate-400 mb-6">Sube tu investigaci√≥n de mercado. El Cerebro IA (GPT-4o) extraer√° los √°ngulos de venta, dolores y deseos del avatar.</p>
            
            <div class="bg-slate-900 p-10 rounded-xl border border-slate-800 shadow-lg border-dashed text-center max-w-3xl">
                <i class="fa-solid fa-file-pdf text-5xl text-rose-500 mb-4 drop-shadow-lg"></i>
                <h3 class="text-xl font-bold text-white mb-2">Sube el documento de la Oferta</h3>
                <p class="text-slate-400 text-sm mb-6">Archivos soportados: PDF, TXT, DOCX. La IA procesar√° el contexto al instante.</p>
                <button class="bg-slate-800 hover:bg-slate-700 text-white font-semibold py-3 px-8 rounded-lg border border-slate-700 transition-all">
                    <i class="fa-solid fa-cloud-arrow-up mr-2"></i> Explorar Archivos
                </button>
            </div>
        </section>

        <section id="laboratorio" class="tab-content">
            <h2 class="text-3xl font-bold mb-2 text-white">2. Laboratorio Creativo</h2>
            <p class="text-slate-400 mb-6">Generaci√≥n masiva de copys y fondos visuales. Define el estilo, revisa y aprueba la tanda antes de inyectar.</p>
            
            <div class="mb-8 bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-lg flex flex-col space-y-5">
                
                <div class="w-full">
                    <label class="block text-xs font-semibold text-sky-400 mb-2 uppercase tracking-wider"><i class="fa-solid fa-terminal mr-2"></i>Director Creativo (Instrucciones IA)</label>
                    <div class="flex items-start bg-slate-800 border border-slate-700 rounded-lg overflow-hidden focus-within:border-sky-500 transition-colors shadow-inner">
                        
                        <input type="file" id="ref-image-upload" accept="image/*" class="hidden" onchange="previewReferencia(event)">
                        
                        <button onclick="document.getElementById('ref-image-upload').click()" class="relative p-4 text-slate-400 hover:text-sky-400 hover:bg-slate-700/50 transition border-r border-slate-700 flex flex-col items-center justify-center h-full min-w-[80px] min-h-[90px] overflow-hidden group cursor-pointer" title="Cargar imagen de referencia">
                            
                            <div id="ref-icon-container" class="flex flex-col items-center transition-all">
                                <i class="fa-solid fa-image text-xl mb-1"></i>
                                <span class="text-[10px] font-semibold uppercase tracking-widest">Ref.</span>
                            </div>
                            
                            <img id="ref-preview-img" src="" class="absolute inset-0 w-full h-full object-cover hidden opacity-40 group-hover:opacity-20 transition-opacity">
                            
                            <i id="ref-delete-icon" onclick="borrarReferencia(event)" class="fa-solid fa-trash-can absolute text-rose-500 hidden z-10 hover:scale-125 transition drop-shadow-md cursor-pointer text-lg"></i>
                        </button>
                        
                        <textarea id="prompt-instruccion" class="w-full bg-transparent text-white p-4 min-h-[90px] focus:outline-none resize-y text-sm leading-relaxed" placeholder="Ej: Genera un fondo para anuncio de marketing. Escenario de oficina moderna, iluminaci√≥n de ne√≥n sutil. Estilo hiperrealista y limpio. Deja espacio negativo en el centro..."></textarea>
                    </div>
                </div>

                <div class="flex flex-wrap justify-between items-end w-full border-t border-slate-800 pt-5 mt-2">
                    <div class="flex space-x-6">
                        <div>
                            <label class="block text-xs font-semibold text-slate-400 mb-2">Cant. de Anuncios</label>
                            <input type="number" id="volumen-tanda" min="1" max="100" value="3" class="bg-slate-800 border border-slate-700 text-white rounded-lg p-2.5 focus:outline-none focus:border-sky-500 min-w-[150px]" placeholder="Ej: 5">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-slate-400 mb-2">Formato Visual</label>
                            <select id="formato-tanda" class="bg-slate-800 border border-slate-700 text-white rounded-lg p-2.5 focus:outline-none focus:border-sky-500 min-w-[150px]">
                                <option value="1080">1080x1080 (Feed)</option>
                                <option value="1920">1080x1920 (Reels/Stories)</option>
                            </select>
                        </div>
                    </div>
                    <button id="btn-generar" onclick="generarCreativos()" class="bg-sky-600 hover:bg-sky-500 text-white font-bold py-3 px-8 rounded-lg shadow-lg shadow-sky-500/30 transition-all flex items-center text-md mt-4 sm:mt-0">
                        <i class="fa-solid fa-wand-magic-sparkles mr-2"></i>Generar Tanda con IA
                    </button>
                </div>
            </div>

            <div id="grilla-resultados" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                <div class="bg-slate-900 rounded-xl border border-slate-800 overflow-hidden shadow-lg opacity-50 flex items-center justify-center p-10 col-span-full">
                    <p class="text-slate-500 text-sm"><i class="fa-solid fa-robot mr-2"></i>Esperando instrucciones para generar creativos...</p>
                </div>
            </div>
        </section>

        <section id="setup" class="tab-content">
            <h2 class="text-3xl font-bold mb-2 text-white">3. Setup Estrat√©gico</h2>
            <p class="text-slate-400 mb-6">Selecciona el objetivo de tu funnel para adaptar las reglas y la estructura de Meta.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                <div onclick="selectTemplate(this, 'low_ticket')" class="template-card cursor-pointer bg-slate-900 border border-slate-700 p-5 rounded-xl hover:border-sky-500 transition-all shadow-lg">
                    <i class="fa-solid fa-cart-shopping text-2xl text-sky-400 mb-3"></i>
                    <h3 class="font-bold text-white mb-1">Venta Low Ticket</h3>
                    <p class="text-xs text-slate-400">Obj: Ventas. CPA objetivo bajo. Optimiza r√°pido por ROAS.</p>
                </div>
                <div onclick="selectTemplate(this, 'high_ticket')" class="template-card cursor-pointer bg-slate-900 border border-slate-700 p-5 rounded-xl hover:border-sky-500 transition-all shadow-lg">
                    <i class="fa-solid fa-gem text-2xl text-purple-400 mb-3"></i>
                    <h3 class="font-bold text-white mb-1">Venta High Ticket</h3>
                    <p class="text-xs text-slate-400">Obj: Leads. CPA alto. Optimiza por CPL y calidad.</p>
                </div>
                <div onclick="selectTemplate(this, 'whatsapp')" class="template-card cursor-pointer bg-slate-900 border border-slate-700 p-5 rounded-xl hover:border-sky-500 transition-all shadow-lg">
                    <i class="fa-brands fa-whatsapp text-2xl text-emerald-400 mb-3"></i>
                    <h3 class="font-bold text-white mb-1">Mensajes a WhatsApp</h3>
                    <p class="text-xs text-slate-400">Obj: Interacci√≥n. Ideal para cierre manual r√°pido.</p>
                </div>
                <div onclick="selectTemplate(this, 'visitas_perfil')" class="template-card cursor-pointer bg-slate-900 border border-slate-700 p-5 rounded-xl hover:border-sky-500 transition-all shadow-lg">
                    <i class="fa-brands fa-instagram text-2xl text-pink-500 mb-3"></i>
                    <h3 class="font-bold text-white mb-1">Visitas al Perfil</h3>
                    <p class="text-xs text-slate-400">Obj: Tr√°fico. Escalar seguidores y alcance org√°nico.</p>
                </div>
            </div>

            <div id="injection-params" class="hidden bg-slate-900 p-8 rounded-xl border border-slate-800 max-w-4xl opacity-0 transition-opacity duration-500 shadow-xl">
                <h3 class="text-lg font-bold text-white mb-6 border-b border-slate-800 pb-3"><i class="fa-solid fa-gears text-sky-400 mr-2"></i>Par√°metros de Inyecci√≥n</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-5">
                        <div>
                            <label class="block text-sm font-semibold text-slate-300 mb-1">Cuenta Publicitaria</label>
                            <select class="w-full bg-slate-800 border border-slate-700 text-white rounded-lg p-3 focus:outline-none focus:border-sky-500">
                                <option>Act Ad Account 1 (ACT_123456789)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-300 mb-1">P√°gina de Facebook</label>
                            <input type="text" placeholder="Ej: Evo Launch Oficial" class="w-full bg-slate-800 border border-slate-700 text-white rounded-lg p-3 focus:outline-none focus:border-sky-500">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-300 mb-1">Cuenta de Instagram</label>
                            <input type="text" placeholder="Ej: @evolaunch" class="w-full bg-slate-800 border border-slate-700 text-white rounded-lg p-3 focus:outline-none focus:border-sky-500">
                        </div>
                    </div>
                    <div class="space-y-5">
                        <div>
                            <label class="block text-sm font-semibold text-slate-300 mb-1">Presupuesto Diario Total (USD)</label>
                            <input type="number" value="40" class="w-full bg-slate-800 border border-slate-700 text-white rounded-lg p-3 focus:outline-none focus:border-sky-500">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-300 mb-1">Pixel ID (API de Conversiones)</label>
                            <input type="text" placeholder="Ej: 9876543210" class="w-full bg-slate-800 border border-slate-700 text-white rounded-lg p-3 focus:outline-none focus:border-sky-500">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-300 mb-1">Segmentaci√≥n Inyectada</label>
                            <input type="text" value="Abierto (Broad) - Sin Intereses" disabled class="w-full bg-slate-800/50 border border-slate-700 text-slate-500 rounded-lg p-3 cursor-not-allowed">
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="lanzamiento" class="tab-content">
            <h2 class="text-3xl font-bold mb-2 text-white">4. Lanzamiento y Preview</h2>
            <p class="text-slate-400 mb-6">Verifica el Payload estructural antes de conectarte a la Graph API de Meta.</p>
            
            <div class="bg-slate-900 border border-slate-700 p-6 rounded-xl mb-6 shadow-lg">
                <h3 class="text-lg font-bold text-white mb-4"><i class="fa-solid fa-eye text-sky-400 mr-2"></i>Preview de Inyecci√≥n (Modelo 1-1-1)</h3>
                <div class="bg-slate-950 p-5 rounded-lg border border-slate-800 font-mono text-sm text-slate-300 overflow-x-auto">
                    <p class="text-sky-400 font-bold mb-3">üì¶ CAMPA√ëA: [Venta Low Ticket] CBO - Tanda 1 (USD $40/d√≠a)</p>
                    <div class="ml-6 border-l-2 border-slate-800 pl-4 space-y-4">
                        <div>
                            <p class="text-emerald-400 font-bold">‚Ü≥ üéØ AD SET 1: Broad - Dynamic Limit</p>
                            <p class="ml-6 text-slate-400">‚Ü≥ üñºÔ∏è AD: T1-SC1-Hook_Dolor (Img_01.png)</p>
                        </div>
                        <div>
                            <p class="text-emerald-400 font-bold">‚Ü≥ üéØ AD SET 2: Broad - Dynamic Limit</p>
                            <p class="ml-6 text-slate-400">‚Ü≥ üñºÔ∏è AD: T1-SC2-Hook_Deseo (Img_02.png)</p>
                        </div>
                        <p class="text-slate-500 italic mt-2">... (Contin√∫a hasta completar los Ad Sets aprobados)</p>
                    </div>
                </div>
            </div>

            <div class="flex space-x-4">
                <button class="bg-sky-600 hover:bg-sky-500 text-white font-bold py-3 px-8 rounded-lg shadow-lg shadow-sky-500/30 transition-all flex items-center text-lg">
                    <i class="fa-solid fa-power-off mr-3"></i> Inyectar como ACTIVE
                </button>
                <button class="bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 px-8 rounded-lg transition-all flex items-center text-lg shadow-lg">
                    <i class="fa-solid fa-pause mr-3"></i> Inyectar como PAUSED
                </button>
            </div>
        </section>

        <section id="analitica" class="tab-content active">
            <h2 class="text-3xl font-bold mb-2 text-white">5. Anal√≠tica & Reglas de Escalado</h2>
            <p class="text-slate-400 mb-6">El motor IA eval√∫a el rendimiento en tiempo real y te dicta la siguiente acci√≥n t√°ctica.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-lg">
                    <h3 class="text-slate-400 text-sm font-semibold mb-2">Gasto de Hoy</h3>
                    <p class="text-3xl font-bold text-white">$145.20</p>
                </div>
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-lg relative overflow-hidden">
                    <div class="absolute right-0 top-0 h-full w-2 bg-emerald-500"></div>
                    <h3 class="text-slate-400 text-sm font-semibold mb-2">ROAS Global</h3>
                    <p class="text-3xl font-bold text-white">2.8x</p>
                </div>
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-lg">
                    <h3 class="text-slate-400 text-sm font-semibold mb-2">CPA Promedio</h3>
                    <p class="text-3xl font-bold text-sky-400">$12.50</p>
                </div>
            </div>

            <div class="bg-slate-900 rounded-xl border border-slate-800 shadow-xl p-6">
                <h3 class="text-lg font-bold mb-4 border-b border-slate-800 pb-3 flex items-center">
                    <i class="fa-solid fa-robot text-sky-400 mr-2"></i> Decisiones Estrat√©gicas Sugeridas
                </h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="text-slate-400 text-sm border-b border-slate-800">
                                <th class="pb-3 px-2">Activo Evaluado</th>
                                <th class="pb-3 px-2">M√©tricas de Alerta</th>
                                <th class="pb-3 px-2">Acci√≥n Sugerida</th>
                                <th class="pb-3 px-2">Ejecutar</th>
                            </tr>
                        </thead>
                        <tbody class="text-sm">
                            <tr class="border-b border-slate-800/50 hover:bg-slate-800/40 transition">
                                <td class="py-4 px-2 font-mono text-sky-300">T1-LowTicket<br><span class="text-xs text-slate-500">Ad Set: Broad 04</span></td>
                                <td class="py-4 px-2">Gasto: $45.00<br>ROAS: <span class="text-rose-400 font-bold">0.8x</span></td>
                                <td class="py-4 px-2 text-rose-400 font-semibold"><i class="fa-solid fa-power-off mr-1"></i> Apagar de Inmediato</td>
                                <td class="py-4 px-2">
                                    <div class="flex space-x-2">
                                        <button class="bg-rose-600/20 text-rose-400 hover:bg-rose-600 hover:text-white px-3 py-1.5 rounded border border-rose-500/30 transition font-bold shadow-md">APLICAR</button>
                                        <button class="bg-slate-700 hover:bg-slate-600 text-white px-3 py-1.5 rounded transition shadow-md"><i class="fa-solid fa-xmark"></i></button>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-slate-800/50 hover:bg-slate-800/40 transition">
                                <td class="py-4 px-2 font-mono text-sky-300">T1-HighTicket<br><span class="text-xs text-slate-500">Ad Set: Broad 01</span></td>
                                <td class="py-4 px-2">Gasto: $25.00<br>ROAS: <span class="text-emerald-400 font-bold">4.5x</span></td>
                                <td class="py-4 px-2 text-emerald-400 font-semibold"><i class="fa-solid fa-arrow-trend-up mr-1"></i> Duplicar Presupuesto (Escalar)</td>
                                <td class="py-4 px-2">
                                    <div class="flex space-x-2">
                                        <button class="bg-emerald-600/20 text-emerald-400 hover:bg-emerald-600 hover:text-white px-3 py-1.5 rounded border border-emerald-500/30 transition font-bold shadow-md">APLICAR</button>
                                        <button class="bg-slate-700 hover:bg-slate-600 text-white px-3 py-1.5 rounded transition shadow-md"><i class="fa-solid fa-xmark"></i></button>
                                    </div>
                                </td>
                            </tr>
                            <tr class="hover:bg-slate-800/40 transition">
                                <td class="py-4 px-2 font-mono text-sky-300">T2-WhatsApp<br><span class="text-xs text-slate-500">Ad Set: Broad 08</span></td>
                                <td class="py-4 px-2">CTR: <span class="text-sky-400 font-bold">3.2%</span><br>Conversi√≥n: <span class="text-rose-400">Baja</span></td>
                                <td class="py-4 px-2 text-amber-400 font-semibold"><i class="fa-solid fa-clone mr-1"></i> Sacar Variaciones (Buen Hook, Falla Oferta)</td>
                                <td class="py-4 px-2">
                                    <div class="flex space-x-2">
                                        <button class="bg-amber-600/20 text-amber-400 hover:bg-amber-600 hover:text-white px-3 py-1.5 rounded border border-amber-500/30 transition font-bold shadow-md">CREAR VARIANTE</button>
                                        <button class="bg-slate-700 hover:bg-slate-600 text-white px-3 py-1.5 rounded transition shadow-md"><i class="fa-solid fa-xmark"></i></button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

    </main>

    <script>
        // L√≥gica de Pesta√±as
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-sky-600', 'text-white');
                btn.classList.add('text-slate-400', 'hover:bg-slate-800', 'hover:text-white');
            });
            document.getElementById(tabId).classList.add('active');
            const activeBtn = document.getElementById('btn-' + tabId);
            activeBtn.classList.remove('text-slate-400', 'hover:bg-slate-800');
            activeBtn.classList.add('bg-sky-600', 'text-white');
        }

        // L√≥gica de Selecci√≥n de Plantilla en Setup
        function selectTemplate(element, type) {
            document.querySelectorAll('.template-card').forEach(card => card.classList.remove('selected'));
            element.classList.add('selected');
            
            const paramsDiv = document.getElementById('injection-params');
            paramsDiv.classList.remove('hidden');
            setTimeout(() => { paramsDiv.classList.remove('opacity-0'); }, 50);
        }

        // --- L√ìGICA DEL BOT√ìN DE REFERENCIA VISUAL ---
        let referenciaBase64 = null; // Aqu√≠ vivir√° la foto convertida a c√≥digo

        function previewReferencia(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                referenciaBase64 = e.target.result; // Guardamos el c√≥digo Base64 de la imagen
                
                // Magia Visual: Ocultamos el √≠cono y mostramos la foto
                document.getElementById('ref-icon-container').classList.add('hidden');
                const imgPreview = document.getElementById('ref-preview-img');
                imgPreview.src = referenciaBase64;
                imgPreview.classList.remove('hidden');
                document.getElementById('ref-delete-icon').classList.remove('hidden');
            };
            reader.readAsDataURL(file); // Convierte la foto a Base64
        }

        function borrarReferencia(event) {
            event.stopPropagation(); // Evita que al hacer clic en borrar, se vuelva a abrir la ventana de subir archivo
            referenciaBase64 = null;
            document.getElementById('ref-image-upload').value = '';
            
            // Restauramos la UI al estado original
            document.getElementById('ref-icon-container').classList.remove('hidden');
            document.getElementById('ref-preview-img').classList.add('hidden');
            document.getElementById('ref-preview-img').src = '';
            document.getElementById('ref-delete-icon').classList.add('hidden');
        }
        
        // --- L√ìGICA DE CONEXI√ìN CON EL BACKEND (PYTHON) ---
        async function generarCreativos() {
            const btn = document.getElementById('btn-generar');
            const promptInput = document.getElementById('prompt-instruccion').value;
            const volumenInput = document.getElementById('volumen-tanda').value;
            const formatoInput = document.getElementById('formato-tanda').value;

            // Validaci√≥n de texto vac√≠o
            if (!promptInput.trim()) {
                alert("‚ö†Ô∏è Escribe las instrucciones para el Director Creativo antes de generar.");
                return;
            }

            // AQUI EST√Å EL CAMBIO DE SEGURIDAD NUM√âRICA
            let cantidad = parseInt(volumenInput);
            if (isNaN(cantidad) || cantidad < 1) {
                alert("‚ö†Ô∏è Por favor ingresa un n√∫mero v√°lido de variaciones (m√≠nimo 1).");
                return;
            }
            
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i>Generando con IA... (10-15s)';
            btn.disabled = true;

            try {
                const response = await fetch('http://127.0.0.1:8000/api/laboratorio/generar', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                    body: JSON.stringify({
                        prompt: promptInput,
                        volumen: cantidad,
                        formato: formatoInput,
                        imagen_referencia: referenciaBase64 // ¬°Aqu√≠ viaja la imagen al backend!
                    })
                });
                
                const data = await response.json();
                
                if(data.status === "success") {
                    console.log("üî• RESULTADO DE LA IA:", data);
                    
                    // 1. Seleccionamos la grilla
                    const grilla = document.getElementById('grilla-resultados');
                    grilla.innerHTML = ''; // Limpiamos los ejemplos falsos
                    
                    // 2. Iteramos sobre los textos generados y creamos las tarjetas
                    data.copys.forEach((copy, index) => {
                        const num = index + 1;
                        
                        // Plantilla HTML din√°mica para cada anuncio
                        const cardHTML = `
                            <div class="bg-slate-900 rounded-xl border border-sky-500/30 overflow-hidden shadow-lg shadow-sky-900/20 transform transition hover:scale-[1.02]">
                                <div class="h-48 bg-slate-800 flex items-center justify-center relative border-b border-slate-800 overflow-hidden">
                                    <img src="${data.imagen_fondo}" alt="Fondo generado por IA" class="w-full h-full object-cover">
                                </div>
                                <div class="p-5">
                                    <div class="flex justify-between items-start mb-2">
                                        <p class="text-xs text-sky-400 font-mono font-bold">T1-SC${num}-IA</p>
                                        <span class="text-[10px] bg-emerald-900/50 px-2 py-1 rounded text-emerald-400 border border-emerald-500/30">Copy IA</span>
                                    </div>
                                    <h4 class="text-sm font-bold text-white mb-1"><i class="fa-solid fa-quote-left text-sky-500 text-xs mr-1"></i> ${copy.hook || copy.headline}</h4>
                                    <p class="text-sm text-slate-300 line-clamp-3 mb-4 leading-relaxed">${copy.primary_text}</p>
                                    
                                    <div class="flex space-x-2 mt-auto">
                                        <button class="flex-1 bg-emerald-600/20 text-emerald-400 hover:bg-emerald-600 hover:text-white border border-emerald-500/30 py-2 rounded text-sm font-bold transition">Aprobar</button>
                                        <button class="flex-1 bg-rose-600/20 text-rose-400 hover:bg-rose-600 hover:text-white border border-rose-500/30 py-2 rounded text-sm font-bold transition">Descartar</button>
                                    </div>
                                </div>
                            </div>
                        `;
                        // Agregamos la tarjeta a la pantalla
                        grilla.innerHTML += cardHTML;
                    });
                    
                } else {
                    alert("Error: " + JSON.stringify(data));
                }
                
            } catch (error) {
                console.error("Error:", error);
                alert("Error de conexi√≥n con el backend.");
            } finally {
                btn.innerHTML = '<i class="fa-solid fa-wand-magic-sparkles mr-2"></i>Generar Tanda con IA';
                btn.disabled = false;
            }
        }

    </script>
    
</body>
</html>
